<!DOCTYPE html>
<html>
<head>
    <title>Diagn√≥stico CoinBitClub</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #000; color: #0f0; }
        .status { margin: 10px 0; padding: 10px; background: #111; border-left: 4px solid #0f0; }
        .error { border-left-color: #f00; color: #f88; }
        .warning { border-left-color: #fa0; color: #fb8; }
        button { padding: 10px 20px; background: #0a0; color: white; border: none; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üîß Diagn√≥stico do Sistema CoinBitClub</h1>
    
    <button onclick="testarTudo()">üöÄ EXECUTAR DIAGN√ìSTICO COMPLETO</button>
    <button onclick="testarLogin()">üîê TESTAR LOGIN DIRETO</button>
    <button onclick="limparResultados()">üßπ LIMPAR</button>
    
    <div id="resultados"></div>

    <script>
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            document.getElementById('resultados').appendChild(div);
        }

        function limparResultados() {
            document.getElementById('resultados').innerHTML = '';
        }

        async function testarTudo() {
            limparResultados();
            log('üî• INICIANDO DIAGN√ìSTICO COMPLETO', 'info');
            
            // Teste 1: Verificar se o servidor est√° rodando
            try {
                const response = await fetch('/');
                log(`‚úÖ Servidor frontend: ${response.status} - OK`, 'info');
            } catch (error) {
                log(`‚ùå Servidor frontend: ERRO - ${error.message}`, 'error');
            }
            
            // Teste 2: Verificar API de health (se existir)
            try {
                const response = await fetch('/api/health');
                if (response.ok) {
                    log(`‚úÖ API Health: ${response.status} - OK`, 'info');
                } else {
                    log(`‚ö†Ô∏è API Health: ${response.status} - N√£o encontrada`, 'warning');
                }
            } catch (error) {
                log(`‚ö†Ô∏è API Health: N√£o dispon√≠vel`, 'warning');
            }
            
            // Teste 3: Verificar localStorage
            try {
                localStorage.setItem('test', 'ok');
                localStorage.removeItem('test');
                log(`‚úÖ LocalStorage: Funcionando`, 'info');
            } catch (error) {
                log(`‚ùå LocalStorage: ERRO - ${error.message}`, 'error');
            }
            
            // Teste 4: Verificar console errors
            log(`‚úÖ Diagn√≥stico conclu√≠do! Agora teste o login.`, 'info');
        }

        async function testarLogin() {
            log('üîê TESTANDO LOGIN...', 'info');
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'faleconosco@coinbitclub.vip',
                        password: 'password'
                    })
                });
                
                log(`üìä Status da resposta: ${response.status}`, 'info');
                
                const data = await response.json();
                
                if (response.ok && data.token) {
                    log(`‚úÖ LOGIN SUCESSO!`, 'info');
                    log(`üë§ Usu√°rio: ${data.user.name} (${data.user.role})`, 'info');
                    log(`üé´ Token: ${data.token.substring(0, 30)}...`, 'info');
                    
                    // Salvar no localStorage
                    localStorage.setItem('auth_token', data.token);
                    localStorage.setItem('user_data', JSON.stringify(data.user));
                    log(`üíæ Dados salvos no localStorage`, 'info');
                    
                } else {
                    log(`‚ùå LOGIN FALHOU: ${data.message || data.error}`, 'error');
                }
                
            } catch (error) {
                log(`‚ùå ERRO DE CONEX√ÉO: ${error.message}`, 'error');
            }
        }

        // Auto-diagn√≥stico ao carregar
        window.onload = function() {
            log('üéØ Sistema carregado. Execute o diagn√≥stico.', 'info');
        };
        
        // Capturar erros JavaScript
        window.onerror = function(msg, url, line, col, error) {
            log(`‚ùå ERRO JS: ${msg} (linha ${line})`, 'error');
        };
    </script>
</body>
</html>
